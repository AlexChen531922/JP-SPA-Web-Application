<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}晶品芳療 JP AROMATIC{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

  {% block head %}
  <style>
    /* =========================================
       1. 整合 index.css (響應式修正版)
       ========================================= */
    .search-wrap {
      flex: 1;
      min-width: 190px;
    }

    .gallery-item {
      position: relative;
      overflow: hidden;
      display: block;
    }

    .gallery-badges {
      position: absolute;
      bottom: 0.65rem;
      right: 0.65rem;
      left: auto;
      top: auto;
      display: flex;
      align-items: end;
      justify-content: end;
      gap: 0.5rem;
      z-index: 1;
      font-size: 1rem;
      padding: 0.5rem 0.75rem;
      border-radius: 9999px;
    }

    /* 確保表格在手機上可以捲動，不會撐破版面 */
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    @media (min-width: 1200px) {
      .dz-minh {
        min-height: 420px;
      }
    }

    /* 圖片與卡片樣式 */
    .dz-wrap {
      border-radius: 1rem;
      overflow: hidden;
    }

    .dz-wrap .dz-border {
      border: 1px solid var(--bs-border-color, #dee2e6);
      transition: all 0.2s ease;
      border-radius: inherit;
      overflow: hidden;
    }

    .dz-wrap:hover .dz-border {
      background: #f8f9fa;
    }

    .hover-zoom {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .hover-zoom:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .hover-zoom .ratio {
      overflow: hidden;
      border-top-left-radius: 0.75rem;
      border-top-right-radius: 0.75rem;
    }

    .hover-zoom img {
      transition: transform 0.35s ease, filter 0.35s ease;
      will-change: transform;
    }

    .hover-zoom:hover img {
      transform: scale(1.06);
      filter: brightness(0.95);
    }

    /* 分頁與徽章 */
    .pagination .page-item.active .page-link {
      background-color: #000;
      border-color: #000;
      color: #fff;
    }

    .pagination .page-link {
      color: #000;
    }

    /* 搜尋框清除按鈕隱藏 */
    input[type="search"]::-webkit-search-cancel-button {
      display: none;
    }

    /* =========================================
       2. 密碼眼睛與輸入框樣式
       ========================================= */
    .input-group>.form-control.password-input {
      border-right: 0 !important;
      border-top-right-radius: 0 !important;
      border-bottom-right-radius: 0 !important;
      box-shadow: none !important;
      z-index: 1 !important;
    }

    .input-group>.btn.password-toggle-btn {
      border-left: 0 !important;
      border-top-left-radius: 0 !important;
      border-bottom-left-radius: 0 !important;
      background-color: white !important;
      color: #6c757d !important;
      border-color: #ced4da !important;
      z-index: 1000 !important;
      cursor: pointer !important;
    }

    .input-group:focus-within {
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
      border-radius: 0.375rem !important;
      border-color: #86b7fe !important;
    }

    .input-group:focus-within .form-control,
    .input-group:focus-within .btn {
      border-color: #86b7fe !important;
    }

    /* =========================================
       3. 響應式導覽列與 Hero 修正 (關鍵修改)
       ========================================= */
    .navbar {
      position: relative;
    }

    /* 預設桌機版 Hero 文字 */
    .header-hero-text {
      font-family: 'Noto Serif TC', serif;
      font-style: italic;
      margin: 0 auto;
      white-space: nowrap;
      font-size: 1.05rem;
      color: #6c6c6c;
      letter-spacing: 1px;
      opacity: 0;
      animation: fadeInOpacity 1.5s ease-in-out forwards;

      /* 增加左右內距，確保縮小到極限時也不會貼太近 */
      padding: 0 20px;

    }

    @keyframes fadeInOpacity {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    .btn-spa {
      font-size: 1.05rem;
      padding: 0.55rem 1.8rem;
      margin-right: 10px;
      background-color: #F7D9E3;
      color: #4B2E39;
      border-radius: 50px;
      transition: all 0.3s;
    }

    .btn-spa:hover {
      background-color: #E3B9CD;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .navbar-nav .nav-link {
      font-size: 1.15rem;
      font-weight: 500;
      padding: 0.6rem 1.2rem;
      margin-right: 10px;
      border-radius: 50px;
      transition: all 0.3s;
      color: #54484d !important;
    }

    .navbar-nav .nav-link:hover {
      transform: translateY(-2px);
      background-color: #F7D9E3;
      color: #2F1B24 !important;
    }

    /* 手機版響應式調整 (Mobile Responsive) */
    @media (max-width: 991.98px) {

      /* 縮小 Logo */
      .navbar-brand img {
        height: 50px !important;
        width: auto !important;
      }

      /* Hero 文字改為靜態流動，避免重疊 */
      .header-hero-text {
        position: static !important;
        transform: none !important;
        text-align: center;
        margin: 1rem 0 !important;
        white-space: normal !important;
        /* 允許換行 */
        font-size: 0.9rem !important;
        display: block;
        padding-bottom: 10px;
      }

      /* 選單置中與間距 */
      .navbar-nav .nav-link {
        text-align: center;
        margin-right: 0;
        margin-bottom: 0.5rem;
      }

      /* 按鈕全寬堆疊 */
      .btn-spa {
        width: 100%;
        margin-right: 0;
        margin-bottom: 1rem;
        text-align: center;
      }

      /* 使用者選單垂直排列 */
      .user-menu-container {
        flex-direction: column;
        width: 100%;
        align-items: stretch !important;
        gap: 0.5rem !important;
      }

      .user-menu-container .btn,
      .user-menu-container .dropdown {
        width: 100%;
        display: block;
      }

      .user-menu-container .dropdown-toggle {
        width: 100%;
        text-align: center;
      }
    }
  </style>
  {% endblock %}
</head>

<body>
  <header class="sticky-top border-bottom bg-white py-2 shadow-sm">
    <nav class="navbar navbar-expand-lg container-fluid">
      <a href="{{ url_for('main.home') }}" class="navbar-brand d-flex align-items-center">
        <img src="{{ url_for('static', filename='img/logo.JPG') }}" alt="LOGO" style="height:110px;width:auto;"
          class="me-3">
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-end" id="navbarMain">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.home') }}">首頁</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.about') }}">關於晶品</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.products') }}">產品介紹</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.courses') }}">課程介紹</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.blog') }}">美麗知識</a></li>
        </ul>

        <section class="header-hero-text">
          <p class="lead text-muted mb-0">專業精進不止，感恩之心常存；健康與美麗內外相映</p>
        </section>

        <a href="{{ url_for('main.courses') }}" class="btn btn-spa fw-bold px-4"><i class="bi bi-calendar-check"></i>
          預約課程</a>

        <div class="d-flex gap-2 align-items-center user-menu-container ms-lg-2">
          {% if session.get('logged_in') %}
          {% set role = session.get('user', {}).get('role') %}
          {% set username = session.get('user', {}).get('firstname') or session.get('user', {}).get('username') %}

          {% if role in ['staff', 'admin'] %}
          <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-primary btn-md">
            <i class="bi bi-speedometer2"></i> 後台
          </a>
          <a href="{{ url_for('main.cart') }}" class="btn btn-outline-primary btn-md position-relative">
            <i class="bi bi-cart3"></i> 購物車
          </a>
          {% elif role == 'customer' %}
          <a href="{{ url_for('main.cart') }}" class="btn btn-outline-primary btn-md position-relative">
            <i class="bi bi-cart3"></i> 購物車
          </a>
          <a href="{{ url_for('customer.dashboard') }}" class="btn btn-outline-secondary btn-md">
            <i class="bi bi-person"></i> 會員
          </a>
          {% endif %}

          <div class="dropdown">
            <button class="btn btn-spa btn-md dropdown-toggle w-100" type="button" data-bs-toggle="dropdown">
              {{ username }}
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              {% if role == 'customer' %}
              <li><a class="dropdown-item" href="{{ url_for('customer.dashboard') }}"><i
                    class="bi bi-person-circle"></i> 會員中心</a></li>
              <li><a class="dropdown-item" href="{{ url_for('customer.bookings') }}"><i
                    class="bi bi-calendar-check"></i> 我的預約</a></li>
              <li><a class="dropdown-item" href="{{ url_for('customer.orders') }}"><i class="bi bi-bag-check"></i>
                  我的訂單</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              {% endif %}
              <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i
                    class="bi bi-box-arrow-right"></i> 登出</a></li>
            </ul>
          </div>
          {% else %}
          <button class="btn btn-spa fw-bold px-4" data-bs-toggle="modal" data-bs-target="#loginModal">
            <i class="bi bi-person-circle"></i> 會員登入
          </button>
          {% endif %}
        </div>
      </div>
    </nav>
  </header>

  {% with messages = get_flashed_messages(with_categories=True) %}
  {% if messages %}
  <div class="position-fixed top-0 start-50 translate-middle-x p-3"
    style="z-index:1080; margin-top: 80px; width: 90%; max-width: 600px;">
    {% for category, msg in messages %}
    {% set alert_type = 'danger' if category in ['error', 'danger'] else category %}
    <div class="alert alert-{{ alert_type }} alert-dismissible fade show shadow-sm rounded-3" role="alert">
      {{ msg }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  <main>
    {% block content %}{% endblock %}
  </main>

  <footer class="bg-light border-top mt-5">
    <div class="container py-5">
      <div class="row gy-4">
        <div class="col-md-4">
          <h5 class="fw-bold mb-3">晶品芳療 JP AROMATIC</h5>
          <p class="text-muted">提供專業芳香療法課程與天然精油產品</p>
          <p class="text-muted small">
            <i class="bi bi-geo-alt"></i> 新北市新莊區思源路296巷37號1樓<br>
            <i class="bi bi-telephone"></i> 02-22777912<br>
            <i class="bi bi-envelope"></i> jpin20200322@gmail.com
          </p>
        </div>
        <div class="col-md-4">
          <h5 class="fw-bold mb-3">快速連結</h5>
          <ul class="list-unstyled">
            <li><a href="{{ url_for('main.about') }}" class="text-muted text-decoration-none">關於晶品</a></li>
            <li><a href="{{ url_for('main.products') }}" class="text-muted text-decoration-none">產品介紹</a></li>
            <li><a href="{{ url_for('main.courses') }}" class="text-muted text-decoration-none">課程介紹</a></li>
            <li><a href="{{ url_for('main.blog') }}" class="text-muted text-decoration-none">美麗知識</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <h5 class="fw-bold mb-3">追蹤我們</h5>
          <div class="d-flex gap-3 mb-3">
            <a href="https://www.facebook.com/j.pin9" target="_blank" class="text-dark fs-3"><i
                class="bi bi-facebook"></i></a>
            <a href="https://www.instagram.com/jpinspa" target="_blank" class="text-dark fs-3"><i
                class="bi bi-instagram"></i></a>
            <a href="https://www.tiktok.com/@j_pin_spa" target="_blank" class="text-dark fs-3"><i
                class="bi bi-tiktok"></i></a>
            <a href="https://line.me/ti/p/~@lhn1950m" target="_blank" class="text-dark fs-3"><i
                class="bi bi-line"></i></a>
          </div>
          <p class="text-muted small">營業時間：週一至週日 09:00-18:00<br>採預約制</p>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-12 text-center text-muted small">
          <p class="mb-0">© 2025 JP AROMATIC SPA. 版權所有 All rights reserved. | <a
              href="{{ url_for('main.privacy_policy') }}" class="text-muted">隱私權政策</a> | <a
              href="{{ url_for('main.terms_of_service') }}" class="text-muted">服務條款</a></p>
        </div>
      </div>
    </div>
  </footer>

  <div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">會員登入 / 註冊</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs mb-3">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab"
                data-bs-target="#signin">登入</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#signup">註冊</button></li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane fade show active" id="signin">
              <form method="POST" action="{{ url_for('auth.login') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="mb-3">
                  <label class="form-label">帳號</label>
                  <input type="text" name="username" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">密碼</label>
                  <div class="input-group password-group">
                    <input type="password" name="password" id="loginPassword" class="form-control password-input"
                      placeholder="請輸入密碼" required>
                    <button class="btn btn-outline-secondary password-toggle-btn" type="button" id="toggleLoginBtn"><i
                        class="bi bi-eye-slash"></i></button>
                  </div>
                  <div class="form-text small mt-1">需含大寫、小寫、數字及符號，至少10碼</div>
                </div>
                <button type="submit" class="btn btn-primary w-100">登入</button>
                <div class="text-center my-2 position-relative">
                  <hr class="m-0">
                  <span
                    class="position-absolute top-50 start-50 translate-middle bg-white px-2 text-muted small">或</span>
                </div>
                <a href="{{ url_for('auth.line_login') }}" class="btn w-100 text-white"
                  style="background-color: #00C300;"><i class="bi bi-line me-2"></i> 使用 LINE 帳號登入</a>
                <div class="text-right mt-3"><a href="{{ url_for('auth.forgot_password') }}"
                    class="small text-decoration-none">忘記密碼？</a></div>
              </form>
            </div>

            <div class="tab-pane fade" id="signup">
              <form method="POST" action="{{ url_for('auth.register') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                {% if session.get('binding_line_name') %}
                <div class="alert alert-success py-2 mb-3 small"><i class="bi bi-line me-1"></i> 正在綁定 LINE 帳號...</div>
                {% endif %}
                <div class="mb-3">
                  <label class="form-label">帳號</label>
                  <input type="text" name="username" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" name="email" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">密碼</label>
                  <div class="input-group password-group">
                    <input type="password" name="password" id="registerPassword" class="form-control password-input"
                      placeholder="請設定密碼" required>
                    <button class="btn btn-outline-secondary password-toggle-btn" type="button"
                      id="toggleRegisterBtn"><i class="bi bi-eye-slash"></i></button>
                  </div>
                  <div class="form-text small mt-1">需含大寫、小寫、數字及符號，至少10碼</div>
                </div>
                <div class="row">
                  <div class="col-6 mb-3">
                    <label class="form-label">姓氏</label>
                    <input type="text" name="surname" class="form-control" required>
                  </div>
                  <div class="col-6 mb-3">
                    <label class="form-label">名字</label>
                    <input type="text" name="firstname" class="form-control" required>
                  </div>
                </div>
                <div class="mb-3">
                  <label class="form-label">LINE ID <span class="text-muted small">(選填)</span></label>
                  <input type="text" name="line_id" class="form-control"
                    value="{{ session.get('binding_line_id', '') }}">
                </div>
                <input type="hidden" name="role" value="customer">
                <button type="submit" class="btn btn-success w-100">註冊</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="floating-social-icons">
    <a href="#" class="social-icon back-to-top">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up-circle"
        viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z" />
        <path fill-rule="evenodd"
          d="M8 12a.5.5 0 0 0 .5-.5V5.707l1.146 1.147a.5.5 0 0 0 .708-.708l-2-2-.007-.007a.498.498 0 0 0-.7 0l-2 2a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z" />
      </svg>
      <span class="icon-label">Top</span>
    </a>
    <a href="https://line.me/ti/p/~@lhn1950m" target="_blank" class="social-icon line"><i class="bi bi-line"></i></a>
    <a href="https://facebook.com/j.pin9" target="_blank" class="social-icon facebook"><i
        class="bi bi-facebook"></i></a>
    <a href="https://instagram.com/jpinspa" target="_blank" class="social-icon instagram"><i
        class="bi bi-instagram"></i></a>
    <a href="tel:0222777912" class="social-icon phone d-md-none"><i class="bi bi-telephone-fill"></i></a>
  </div>

  <style>
    .floating-social-icons {
      position: fixed;
      right: 20px;
      bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 9999;
    }

    .floating-social-icons .social-icon {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background-color: #333;
      color: #FFD700;
      text-decoration: none;
      overflow: visible;
      z-index: 0;
      transition: transform 0.2s, background 0.3s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .floating-social-icons .social-icon:hover {
      transform: scale(1.1);
    }

    .floating-social-icons .social-icon.back-to-top:hover {
      background-color: #FFD700;
      color: white;
    }

    .floating-social-icons .social-icon.line:hover {
      background-color: #00C300;
    }

    .floating-social-icons .social-icon.facebook:hover {
      background-color: #1877F2;
    }

    .floating-social-icons .social-icon.instagram:hover {
      background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
    }

    .floating-social-icons .social-icon.phone {
      background-color: #28a745;
      color: white;
    }

    /* 手機版專用撥號按鈕 */

    .floating-social-icons .icon-label {
      position: absolute;
      right: 110%;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }

    .floating-social-icons .social-icon:hover .icon-label {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .floating-social-icons .icon-label {
        display: none;
      }

      /* 手機版不顯示浮動標籤 */
      .floating-social-icons .social-icon {
        width: 40px;
        height: 40px;
      }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  {% block scripts %}{% endblock %}

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.body.addEventListener('click', function (e) {
        const btn = e.target.closest('.password-toggle-btn');
        if (!btn) return;
        e.preventDefault(); e.stopPropagation();
        const inputGroup = btn.closest('.input-group');
        const input = inputGroup.querySelector('input.password-input');
        const icon = btn.querySelector('i');
        if (input) {
          if (input.getAttribute('type') === 'password') {
            input.setAttribute('type', 'text');
            icon.classList.replace('bi-eye-slash', 'bi-eye');
          } else {
            input.setAttribute('type', 'password');
            icon.classList.replace('bi-eye', 'bi-eye-slash');
          }
        }
      });
    });
  </script>
</body>

</html>