<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Index Page{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}" />
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" />
  {% block head %}{% endblock %}
</head>

<body>
  <header class="sticky-top border-bottom py-2 bg-white">
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid align-items-center gap-2">

        <a href="{{ url_for('main.index') }}" class="navbar-brand fw-semibold">G5 EVENTHUB</a>

        <form class="search-wrap flex-grow-1 my-0 px-lg-3" role="search" method="get"
          action="{{ url_for('main.index') }}">
          <div class="input-group">
            <input id="searchInput" class="form-control" type="search" placeholder="Search images" name="q"
              value="{{ request.args.get('q', '') }}" aria-label="Search" />

            {% if request.args.get('q') %}
            <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary" aria-label="Clear search">✕</a>
            {% endif %}

            <button class="btn btn-outline-secondary" type="submit" aria-label="Search">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search"
                viewBox="0 0 16 16">
                <path
                  d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85zM6.5 11a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9z" />
              </svg>
            </button>
          </div>
        </form>

        <div class="d-none d-lg-flex align-items-center gap-2 ms-auto">

          {% if session.get('logged_in') %}
          {% set _role = session.get('user', {}).get('role') %}

          {% if _role in ['vendor', 'admin'] %}
          <a class="btn"
            href="{{ url_for('vendor.management') if _role=='vendor' else url_for('main.vendor_management') }}"
            aria-label="Dashboard" title="Dashboard">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-kanban"
              viewBox="0 0 16 16">
              <path
                d="M13.5 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm-11-1a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z" />
              <path
                d="M6.5 3a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1zm-4 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1zm8 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1z" />
            </svg>
          </a>
          {% endif %}

          {% if _role == 'vendor' %}
          <a class="btn" href="{{ url_for('vendor.my_gallery') }}" aria-label="Gallery" title="Gallery">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-images"
              viewBox="0 0 16 16">
              <path d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" />
              <path
                d="M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2M14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1M2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1z" />
            </svg>
          </a>
          {% endif %}

          {% if _role == 'customer' %}
          <a class="btn" href="{{ url_for('main.get_cart', user_id=current_user_id) }}" aria-label="Checkout"
            title="Cart">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-bag-heart"
              viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0M14 14V5H2v9a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1M8 7.993c1.664-1.711 5.825 1.283 0 5.132-5.825-3.85-1.664-6.843 0-5.132" />
            </svg>
          </a>
          {% endif %}

          <a class="btn btn-outline-dark" href="{{ url_for('main.logout') }}">Sign Out</a>

          {% else %}
          <button class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#loginModal">Sign In</button>
          {% endif %}
        </div>

        {% if session.get('logged_in') %}
        <div class="dropdown d-lg-none ms-auto">
          <button class="btn btn-outline-secondary rounded-3" type="button" id="mobileMenuBtn" data-bs-toggle="dropdown"
            data-bs-auto-close="outside" aria-expanded="false" aria-label="Open menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z" />
            </svg>
          </button>
          <div class="dropdown-menu dropdown-menu-end p-2 shadow rounded-4 border-0" aria-labelledby="mobileMenuBtn"
            style="min-width:320px">
            <div class="list-group">
              {% set _role = session.get('user', {}).get('role') %}
              {% if _role == 'admin' %}
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2"
                href="{{ url_for('vendor.management') if _role=='vendor' else url_for('main.vendor_management') }}">
                Dashboard
              </a>
              {% elif _role == 'vendor' %}
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2"
                href="{{ url_for('vendor.management') if _role=='vendor' else url_for('main.vendor_management') }}">
                Dashboard
              </a>
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2"
                href="{{ url_for('vendor.my_gallery') }}">
                Gallery
              </a>
              {% else %}
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2"
                href="{{ url_for('main.get_cart', user_id=current_user_id) }}">
                Cart
              </a>
              {% endif %}
              <a class="list-group-item list-group-item-action d-flex align-items-center gap-2 text-dark fw-semibold"
                href="{{ url_for('main.logout') }}">Log Out</a>
            </div>
          </div>
        </div>
        {% else %}
        <div class="dropdown d-lg-none ms-auto">
          <button class="btn btn-outline-secondary rounded-3" type="button" id="mobileMenuBtn" data-bs-toggle="dropdown"
            data-bs-auto-close="outside" aria-expanded="false" aria-label="Open menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z" />
            </svg>
          </button>
          <div class="dropdown-menu dropdown-menu-end p-2 shadow rounded-4 border-0" aria-labelledby="mobileMenuBtn"
            style="min-width:320px">
            <div class="list-group">
              <button
                class="list-group-item list-group-item-action d-flex align-items-center gap-2 text-dark fw-semibold"
                data-bs-toggle="modal" data-bs-target="#loginModal">
                Sign In
              </button>
            </div>
          </div>
        </div>
        {% endif %}

      </div>
    </nav>
  </header>

  <main>
    <div class="container-fluid bg-body-secondary py-2">
      <div class="d-flex flex-wrap align-items-center gap-2 w-100 justify-content-start justify-content-lg-center">
        <form method="get" id="sortForm" class="d-inline">
          <input type="hidden" name="q" value="{{ q }}">
          <input type="hidden" name="category" value="{{ active_category }}">
          <select name="sort" class="form-select form-select-sm w-auto"
            onchange="document.getElementById('sortForm').submit()">
            <option value="latest" {% if sort=='latest' %}selected{% endif %}>Latest</option>
            <option value="popular" {% if sort=='popular' %}selected{% endif %}>Popular</option>
            <option value="price-asc" {% if sort=='price-asc' %}selected{% endif %}>Price (Low–High)</option>
            <option value="price-desc" {% if sort=='price-desc' %}selected{% endif %}>Price (High–Low)</option>
          </select>
        </form>

        {% for category in categories %}
        <a href="{{ url_for('main.index', category=category) }}"
          class="btn btn-sm btn-chip {{ 'btn-secondary text-white' if category == active_category else 'btn-outline-secondary' }}">
          #{{ category|capitalize }}
        </a>
        {% endfor %}
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
    <div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index:1080">
      {% for category, msg in messages %}
      {% set cat = 'danger' if category in ['error','danger'] else category %}
      <div class="alert alert-{{ cat }} alert-dismissible fade show shadow-sm rounded-3" role="alert">
        {{ msg | safe }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <footer class="bg-light border-top mt-5">
    <div class="container py-4">
      <div class="row gy-3">
        <div class="col-md">
          <div class="small">
            <a href="#" class="link-secondary">Licensing</a> ·
            <a href="#" class="link-secondary">Accessibility</a> ·
            <a href="#" class="link-secondary">Terms</a> ·
            <a href="#" class="link-secondary">Contact</a>
          </div>
          <div class="text-muted small mt-1">©2025 IFN582 Group 5 · Images from Unsplash</div>
        </div>
      </div>
    </div>
  </footer>

  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="loginModalLabel">Sign In</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <ul class="nav nav-tabs mb-3" id="authTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="signin-tab" data-bs-toggle="tab" data-bs-target="#signin"
                type="button" role="tab" aria-controls="signin" aria-selected="true">
                Sign In
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="signup-tab" data-bs-toggle="tab" data-bs-target="#signup" type="button"
                role="tab" aria-controls="signup" aria-selected="false">
                Sign Up
              </button>
            </li>
          </ul>

          <div class="tab-content" id="authTabContent">
            <div class="tab-pane fade show active" id="signin" role="tabpanel" aria-labelledby="signin-tab">
              <form action="{{ url_for('main.login') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="mb-3">
                  <label for="signin-username" class="form-label">Username</label>
                  <input type="text" class="form-control" id="signin-username" name="username"
                    placeholder="Enter username" required />
                </div>
                <div class="mb-3">
                  <label for="signin-password" class="form-label">Password</label>
                  <input type="password" class="form-control" id="signin-password" name="password"
                    placeholder="Enter password" required />
                </div>
                <button type="submit" class="btn btn-primary w-100">Login</button>
              </form>
              <div class="mt-2 text-end">
                <a href="#">Forgot password?</a>
              </div>
            </div>

            <div class="tab-pane fade" id="signup" role="tabpanel" aria-labelledby="signup-tab">
              <form action="{{ url_for('main.register') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="mb-3">
                  <label for="signup-username" class="form-label">Username</label>
                  <input type="text" class="form-control" id="signup-username" name="username"
                    placeholder="Choose username" required />
                </div>
                <div class="mb-3">
                  <label for="signup-email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="signup-email" name="email" placeholder="Enter email"
                    required />
                </div>
                <div class="mb-3">
                  <label for="signup-password" class="form-label">Password</label>
                  <input type="password" class="form-control" id="signup-password" name="password"
                    placeholder="Choose password" required />
                </div>
                <div class="mb-3">
                  <label for="signup-firstname" class="form-label">First Name</label>
                  <input type="text" class="form-control" id="signup-firstname" name="firstname"
                    placeholder="Enter first name" required />
                </div>
                <div class="mb-3">
                  <label for="signup-surname" class="form-label">Surname</label>
                  <input type="text" class="form-control" id="signup-surname" name="surname" placeholder="Enter surname"
                    required />
                </div>
                <div class="mb-3">
                  <label for="signup-role" class="form-label">Register as</label>
                  <select class="form-select" id="signup-role" name="role" required>
                    <option value="customer">Customer</option>
                    <option value="vendor">Vendor</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-success w-100">Sign Up</button>
              </form>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <small class="text-muted">New here? Use the Sign Up tab above.</small>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  {% block scripts %}{% endblock %}
</body>

</html>